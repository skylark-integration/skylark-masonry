/**
 * skylark-masonry - A version of masonry that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-masonry/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-jquery"],function(t,i){"use strict";var e=window.console,o={};function n(t,n){var s=h(t);if(s){this.element=s,i&&(this.$element=i(this.element)),this.options=i.extend({},this.constructor.defaults),this.option(n);var a=++r;this.$element.data("outlayerGUID",a),o[a]=this,this._create(),this._getOption("initLayout")&&this.layout()}else e&&e.error("Bad element for "+this.constructor.namespace+": "+(s||t))}n.namespace="masonry",n.Item=function(t,i){this.element=t,this.layout=i,this.position={x:0,y:0}},n.Item.prototype.getSize=function(){return this.size={outerWidth:$(this.element).outerWidth(!0),outerHeight:$(this.element).outerHeight(!0)}},n.Item.prototype.goTo=function(t,i){this.position.x=parseInt(t,10),this.position.y=parseInt(i,10),$(this.element).css({position:"absolute",left:this.position.x+"px",top:this.position.y+"px"})},n.Item.prototype.moveTo=function(t,i){$(this.element).css({position:"absolute"}),$(this.element).moveto(t,i)},n.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}},n.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},n.compatOptions.fitWidth="isFitWidth",n.prototype.getSize=function(){this.size={width:$(this.element).width(),height:$(this.element).height()}},n.prototype._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var t=0;t<this.cols;t++)this.colYs.push(0);this.maxY=0},n.prototype.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var t=this.items[0];t&&t.element;this.columnWidth=t&&t.getSize().outerWidth||this.containerWidth}var i=this.columnWidth+=this.gutter,e=this.containerWidth+this.gutter,o=e/i,n=i-e%i;o=Math[n&&n<1?"round":"floor"](o),this.cols=Math.max(o,1)},n.prototype.getContainerWidth=function(){var t=this._getOption("fitWidth")?this.element.parentNode:this.element;this.containerWidth=$(t).width()},n.prototype._getItemLayoutPosition=function(t){t.getSize();var i=t.size.outerWidth%this.columnWidth,e=Math[i&&i<1?"round":"ceil"](t.size.outerWidth/this.columnWidth);e=Math.min(e,this.cols);for(var o=this._getColGroup(e),n=Math.min.apply(Math,o),s=o.indexOf(n),r={x:this.columnWidth*s,y:n},h=n+t.size.outerHeight,a=this.cols+1-o.length,u=0;u<a;u++)this.colYs[s+u]=h;return r},n.prototype._getColGroup=function(t){if(t<2)return this.colYs;for(var i=[],e=this.cols+1-t,o=0;o<e;o++){var n=this.colYs.slice(o,o+t);i[o]=Math.max.apply(Math,n)}return i},n.prototype._manageStamp=function(t){var i=getSize(t),e=this._getElementOffset(t),o=this._getOption("originLeft")?e.left:e.right,n=o+i.outerWidth,s=Math.floor(o/this.columnWidth);s=Math.max(0,s);var r=Math.floor(n/this.columnWidth);r-=n%this.columnWidth?0:1,r=Math.min(this.cols-1,r);for(var h=(this._getOption("originTop")?e.top:e.bottom)+i.outerHeight,a=s;a<=r;a++)this.colYs[a]=Math.max(h,this.colYs[a])},n.prototype._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var t={height:this.maxY};return this._getOption("fitWidth")&&(t.width=this._getContainerFitWidth()),t},n.prototype._getContainerFitWidth=function(){for(var t=0,i=this.cols;--i&&0===this.colYs[i];)t++;return(this.cols-t)*this.columnWidth-this.gutter},n.prototype.needsResizeLayout=function(){var t=this.containerWidth;return this.getContainerWidth(),t!=this.containerWidth};var s=n.prototype,r=0,h=function(t){return"string"==typeof t?document.querySelector(t):t},a=function(t){var i=[];if(Array.isArray(t))i=t;else if(t&&"number"==typeof t.length)for(var e=0;e<t.length;e++)i.push(t[e]);else i.push(t);return i},u=Array.prototype.indexOf?function(t,i){return t.indexOf(i)}:function(t,i){for(var e=0,o=t.length;e<o;e++)if(t[e]===i)return e;return-1};return s.option=function(t){i.extend(this.options,t)},s._getOption=function(t){var i=this.constructor.compatOptions[t];return i&&void 0!==this.options[i]?this.options[i]:this.options[t]},s._create=function(){this.reloadItems(),i.extend(this.element.style,this.options.containerStyle)},s.reloadItems=function(){this.items=this._itemize(this.element.children)},s._itemize=function(t){for(var i=this._filterFindItemElements(t),e=this.constructor.Item,o=[],n=0;n<i.length;n++){var s=new e(i[n],this);o.push(s)}return o},s._filterFindItemElements=function(t){return function(t,e){var o=[];return(t=a(t)).forEach(function(t){if(t instanceof HTMLElement)if(e){i(t).is(e)&&o.push(t);for(var n=t.querySelectorAll(e),s=0;s<n.length;s++)o.push(n[s])}else o.push(t)}),o}(t,this.options.itemSelector)},s.layout=function(){this._resetLayout();var t=this._getOption("layoutInstant"),i=void 0!==t?t:!this._isLayoutInited;this.layoutItems(this.items,i),this._isLayoutInited=!0},s._getMeasurement=function(t,i){var e,o=this.options[t];o?("string"==typeof o?e=this.element.querySelector(o):o instanceof HTMLElement&&(e=o),this[t]=e?$(e)[i]():o):this[t]=0},s.layoutItems=function(t,i){t=this._getItemsForLayout(t),this._layoutItems(t,i),this._postLayout()},s._getItemsForLayout=function(t){return t.filter(function(t){return!t.isIgnored})},s._layoutItems=function(t,i){if(t&&t.length){var e=[];t.forEach(function(t){var o=this._getItemLayoutPosition(t);o.item=t,o.isInstant=i||t.isLayoutInstant,e.push(o)},this),this._processLayoutQueue(e)}},s._processLayoutQueue=function(t){t.forEach(function(t){this._positionItem(t.item,t.x,t.y,t.isInstant)},this)},s._positionItem=function(t,i,e,o){o?t.goTo(i,e):t.moveTo(i,e)},s._postLayout=function(){this.resizeContainer()},s.resizeContainer=function(){if(this._getOption("resizeContainer")){var t=this._getContainerSize();t&&(this._setContainerMeasure(t.width,!0),this._setContainerMeasure(t.height,!1))}},s._setContainerMeasure=function(t,i){if(void 0!==t){var e=this.size;e.isBorderBox&&(t+=i?e.paddingLeft+e.paddingRight+e.borderLeftWidth+e.borderRightWidth:e.paddingBottom+e.paddingTop+e.borderTopWidth+e.borderBottomWidth),t=Math.max(t,0),this.element.style[i?"width":"height"]=t+"px"}},s.addItems=function(t){var i=this._itemize(t);return i.length&&(this.items=this.items.concat(i)),i},s.appended=function(t){var i=this.addItems(t);i.length&&(this.layoutItems(i,!0),this.reveal(i))},s.prepended=function(t){var i=this._itemize(t);if(i.length){var e=this.items.slice(0);this.items=i.concat(e),this._resetLayout(),this.layoutItems(i,!0),this.reveal(i),this.layoutItems(e)}},s.reveal=function(t){t&&t.length&&t.forEach(function(t){})},s.hide=function(t){t&&t.length&&t.forEach(function(t){t.hide()})},s.revealItemElements=function(t){var i=this.getItems(t);this.reveal(i)},s.hideItemElements=function(t){var i=this.getItems(t);this.hide(i)},s.getItem=function(t){for(var i=0;i<this.items.length;i++){var e=this.items[i];if(e.element==t)return e}},s.getItems=function(t){var i=[];return(t=a(t)).forEach(function(t){var e=this.getItem(t);e&&i.push(e)},this),i},s.remove=function(t){var i=this.getItems(t);i&&i.length&&i.forEach(function(t){var i,e;t.element&&t.element.remove(),i=this.items,-1!=(e=u(i,t))&&i.splice(e,1)},this)},t.attach("intg.Masonry",n)});
//# sourceMappingURL=sourcemaps/Masonry.js.map
